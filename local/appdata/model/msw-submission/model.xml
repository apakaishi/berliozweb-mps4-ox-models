<?xml version="1.0" encoding="utf-8"?>
<!--
  This document defines the pipelines for the conversion ox model.
-->
<pipelines icon="file-move">
  <pipeline id="mps4-submission-conversion" name="MPS4 Submission Bus: Generate Document for Bus Submission" accepts="application/xlsx"  default="false">
    <!-- Unzip excel document-->
    <step id="extract-data-from-spreadsheet" name="Extract data from Spreadsheet" viewable="false" class="org.pageseeder.xlsx.ox.step.Import">
      <parameter name="split-level"      value="workbook"/>
      <parameter name="output"           value="data"/>
      <parameter name="xslt"             value="bus/workbook-transformation.xsl"/>
    </step>
    <step id="validate-extracted-data" name="Validate extracted data"
          class="org.pageseeder.ox.schematron.step.SchematronValidation"
          async="false">
      <parameter name="input"  value="data/workbook.xml" />
      <parameter name="schema" value="sch/validate-extracted-data.sch" />
    </step>
    <step id="create-files-properties" name="Create Files Properties" viewable="false" class="org.pageseeder.ox.step.Transformation">
      <parameter name="input"                     value="data/workbook.xml" />
      <parameter name="_xslt-output-folder"       value="bus-documents" />
      <parameter name="xsl"                       value="bus/bus-submission_v2.xsl"/>
      <parameter name="output"                    value="files/document.xml"/>
    </step>
    <step id="zip-full-package" name="Zipping PSML document with images folder." class="org.pageseeder.ox.step.Compression">
      <parameter name="input" value="bus-documents" />
      <parameter name="output" value="mps4-submission.zip"/>
    </step>
  </pipeline>

</pipelines>



