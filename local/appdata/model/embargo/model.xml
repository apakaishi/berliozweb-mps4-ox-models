<?xml version="1.0" encoding="utf-8"?>
<!--
  This document defines the pipelines for the conversion ox model.
-->
<pipelines  title="Embargo">

    <pipeline id="embargo-shell-simple-file"
              name="Upload One Document (DOCX/PDF)"
              description="Upload One Document (DOCX/PDF)"
              accepts="application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/pdf"
              default="true">

        <fields>
            <field type="calendar"
                    id="publish_date"
                    name="publish_date"
                    label="Publish Date"
                    value=""
                    min=""
                    max=""
                    noTitle="false"
                    landscape="true"
                    current="true"
                    prevMonths=""
                    nextMonths=""
                    increment="1"
                    readonly="false"
            />
            <field  type="text"
                    id="title"
                    name="title"
                    label="Document Title"
                    value=""
                    rules="required"
            />
        </fields>

        <step id="copy-input-file" name="Copy Input File" viewable="false" class="net.pageseeder.ox.web.step.CopyInputToFolder">
            <parameter name="output"                value="final/binary/{publish_date_year}/{publish_date_month}"/>
        </step>
<!--        <step id="copy-input-file" name="Copy Input File" viewable="false" class="org.pageseeder.ox.step.Copy">-->
<!--            <parameter name="output"                value="final/binary/{publish_date_year}/{publish_date_month}/{_uploaded_file}"/>-->
<!--        </step>-->
        <step id="copy-document-xml" name="Copying document.xml" class="org.pageseeder.ox.step.Copy">
            <parameter name="input"                 value="resources" />
            <parameter name="output"                value="files/resources"/>
        </step>
        <step id="create-shell-psml-document" name="Create Shell PSML Document" viewable="false" class="org.pageseeder.ox.step.Transformation">
            <parameter name="input"                 value="files/resources/document.xml" />
            <parameter name="xsl"                   value="xslt/simple-file.xsl"/>
            <parameter name="output"                value="files/document.psml"/>
        </step>
        <step id="zip-psml-output" name="Zipping PSML Document." class="org.pageseeder.ox.step.Compression">
            <parameter name="input"                 value="final/output" />
            <parameter name="output"                value="embargo.zip"/>
        </step>
        <step id="upload-to-pageseeder-loadingzone" name="Upload ZIP to Pageseeder - PSML Document" class="org.pageseeder.ox.pageseeder.step.UploadToLoadingZone"
              async="false" >
            <parameter name="input"                 value="embargo.zip" />
            <parameter name="filename"              value="embargo.zip" />
            <parameter name="autoload"              value="false" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite"             value="true" />
            <parameter name="group"                 value="data_source-website" />
        </step>
        <step id="unzip-loadingzone-content" name="Unzip File in Pageseeder - PSML Document" class="org.pageseeder.ox.pageseeder.step.UnzipLoadingZoneContent">
            <parameter name="group"                 value="data_source-website" />
            <parameter name="path"                  value="embargo.zip" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="deleteoriginal"        value="true" />
        </step>
        <step id="loads-content-to-the-group" name="Load Unzipped Content to Pageseeder Group  - PSML documents" class="org.pageseeder.ox.pageseeder.step.StartLoading">
            <parameter name="group"                 value="data_source-website" />
            <parameter name="createxrefs"           value="true" />
            <parameter name="index"                 value="true" />
            <parameter name="overwrite"             value="true" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite-properties"  value="true" />
            <parameter name="validate"              value="true" />
            <parameter name="folder"                value="website/embargo"/>
        </step>
        <step id="zip-binary-documents" name="Zipping Binary Document." class="org.pageseeder.ox.step.Compression">
            <parameter name="input"                 value="final/binary" />
            <parameter name="output"                value="binary.zip"/>
        </step>
        <step id="upload-to-pageseeder-loadingzone-binary" name="Upload ZIP to Pageseeder - Binary Document" class="org.pageseeder.ox.pageseeder.step.UploadToLoadingZone"
              async="false" >
            <parameter name="input"                 value="binary.zip" />
            <parameter name="filename"              value="binary.zip" />
            <parameter name="autoload"              value="false" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite"             value="true" />
            <parameter name="group"                 value="data_source-files" />
        </step>
        <step id="unzip-loadingzone-content-binary" name="Unzip File in Pageseeder - Binary Document" class="org.pageseeder.ox.pageseeder.step.UnzipLoadingZoneContent">
            <parameter name="group"                 value="data_source-files" />
            <parameter name="path"                  value="binary.zip" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="deleteoriginal"        value="true" />
        </step>
        <step id="loads-content-to-the-group-binary" name="Load Unzipped Content to Pageseeder Group - Binary Document" class="org.pageseeder.ox.pageseeder.step.StartLoading">
            <parameter name="group"                 value="data_source-files" />
            <parameter name="createxrefs"           value="true" />
            <parameter name="index"                 value="true" />
            <parameter name="overwrite"             value="true" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite-properties"  value="true" />
            <parameter name="validate"              value="true" />
            <parameter name="folder"                value="documents/embargo"/>
        </step>
    </pipeline>

    <pipeline id="embargo-shell-multiple-files"
              name="Upload Multiple Files (ZIP)"
              description="Upload Multiple Files (ZIP)"
              accepts="application/zip"
              default="true">

        <fields>
            <field type="month"
                    id="publish_date"
                    name="publish_date"
                    label="Publish Date"
                    value=""
                    increment="1"
                    readonly="true"
            />
            <field  type="text"
                    id="title"
                    name="title"
                    label="Document Title"
                    value=""
                    rules="required"
            />

        </fields>
        <step id="Unzip" name="Unzipping Document." class="org.pageseeder.ox.step.Decompression">
            <parameter name="output"                value="final/binary/{publish_date_year}/{publish_date_month}" />
        </step>
        <step id="copy-input-file" name="Copy Input File" viewable="false" class="net.pageseeder.ox.web.step.CopyInputToFolder">
            <parameter name="output"                value="final/binary/{publish_date_year}/{publish_date_month}"/>
        </step>
        <step id="list-documents-path" name="Return a XML document with a list of documents" viewable="false" class="org.pageseeder.ox.step.ListFiles" async="true">
            <parameter name="input"                 value="final/binary/{publish_date_year}/{publish_date_month}"/>
            <parameter name="glob-pattern"          value="*.*"/>
            <parameter name="output"                value="files/list-files.xml"/>
        </step>
        <step id="create-shell-psml-document" name="Create Shell PSML Document" viewable="false" class="org.pageseeder.ox.step.Transformation">
            <parameter name="input"                 value="files/list-files.xml" />
            <parameter name="xsl"                   value="xslt/multiple-files.xsl"/>
            <parameter name="output"                value="files/document.psml"/>
        </step>
        <step id="zip-full-package" name="Zipping PSML Documents." class="org.pageseeder.ox.step.Compression">
            <parameter name="input"                 value="final/output" />
            <parameter name="output"                value="embargo.zip"/>
        </step>
        <step id="upload-to-pageseeder-loadingzone" name="Upload ZIP to Pageseeder - PSML Documents" class="org.pageseeder.ox.pageseeder.step.UploadToLoadingZone"
              async="false" >
            <parameter name="input"                 value="embargo.zip" />
            <parameter name="filename"              value="embargo.zip" />
            <parameter name="autoload"              value="false" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite"             value="true" />
            <parameter name="group"                 value="data_source-website" />
        </step>
        <step id="unzip-loadingzone-content" name="Unzip File in Pageseeder - PSML Documents" class="org.pageseeder.ox.pageseeder.step.UnzipLoadingZoneContent">
            <parameter name="group"                 value="data_source-website" />
            <parameter name="path"                  value="embargo.zip" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="deleteoriginal"        value="true" />
        </step>
        <step id="loads-content-to-the-group" name="Load Unzipped Content to Pageseeder Group  - PSML documents" class="org.pageseeder.ox.pageseeder.step.StartLoading">
            <parameter name="group"                 value="data_source-website" />
            <parameter name="createxrefs"           value="true" />
            <parameter name="index"                 value="true" />
            <parameter name="overwrite"             value="true" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite-properties"  value="true" />
            <parameter name="validate"              value="true" />
            <parameter name="folder"                value="website/embargo"/>
        </step>
        <step id="zip-binary-documents" name="Zipping Binary Documents." class="org.pageseeder.ox.step.Compression">
            <parameter name="input"                 value="final/binary" />
            <parameter name="output"                value="binary.zip"/>
        </step>
        <step id="upload-to-pageseeder-loadingzone-binary" name="Upload ZIP to Pageseeder - Binary Documents" class="org.pageseeder.ox.pageseeder.step.UploadToLoadingZone"
              async="false" >
            <parameter name="input"                 value="binary.zip" />
            <parameter name="filename"              value="binary.zip" />
            <parameter name="autoload"              value="false" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite"             value="true" />
            <parameter name="group"                 value="data_source-files" />
        </step>
        <step id="unzip-loadingzone-content-binary" name="Unzip File in Pageseeder - Binary Documents" class="org.pageseeder.ox.pageseeder.step.UnzipLoadingZoneContent">
            <parameter name="group"                 value="data_source-files" />
            <parameter name="path"                  value="binary.zip" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="deleteoriginal"        value="true" />
        </step>
        <step id="loads-content-to-the-group-binary" name="Load Unzipped Content to Pageseeder Group - Binary Documents" class="org.pageseeder.ox.pageseeder.step.StartLoading">
            <parameter name="group"                 value="data_source-files" />
            <parameter name="createxrefs"           value="true" />
            <parameter name="index"                 value="true" />
            <parameter name="overwrite"             value="true" />
            <parameter name="psconfig"              value="dev-clone" />
            <parameter name="overwrite-properties"  value="true" />
            <parameter name="validate"              value="true" />
            <parameter name="folder"                value="documents/embargo"/>
        </step>

    </pipeline>


    <pipeline id="mps4-conversion" name="MPS4: Excel to PSML"
              description="MPS4: Excel to PSML"
              accepts="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
              default="false">

        <step id="extract-data-from-spreadsheet" name="Extract data from Spreadsheet" viewable="false"
              class="org.pageseeder.xlsx.ox.step.Import">
            <parameter name="split-level"          value="workbook"/>
        </step>

        <step id="converting-to-psml" name="Converting to PSML documents" viewable="false"
              class="org.pageseeder.ox.step.Transformation"
              async="true" >
            <parameter name="input"                 value="workbook.xml" />
            <parameter name="xsl"    		    	  value="xslt/create-psml-documents.xsl"/>
            <parameter name="output" 			      value="review/data.psml"/>
        </step>

        <!-- Zip output files  -->
        <step id="zip-pbs-files" name="Zipping PBS files"
              class="org.pageseeder.ox.step.Compression"
              async="false" >
            <parameter name="input" value="final" />
            <parameter name="output" value="documents.zip"/>
        </step>

    </pipeline>

</pipelines>



